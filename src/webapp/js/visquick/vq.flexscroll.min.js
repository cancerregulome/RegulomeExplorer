//intialize with var data ={DATATYPE : "vq.models.FlexScrollData", CONTENTS : "test"};
// notifier = function(x,dx) where x = position within scroll bar range,  dx = total length of window in scale of scroll bar
//draw with draw (data ={DATATYPE : "vq.models.FlexScrollData", CONTENTS : "test"}
//				and options = {plotHeight: xx, plotWidth : xx, vertical_padding: xx,
//				horizontal_padding : xx , max_position: xx, min_position: xx,
//				maxRange: xx, minRange: xx, dblclick_notifier : function(x,dx),
//				fixed_window_width: xx, scale_multiplier : xx, interval : xx, font : "fontname"}
//note dblclick_notifer is the last listed option.  This can be used to create a "zoom" effect by re-instanstiating the scroll bar with new parameters.
vq.FlexScroll=function(){vq.Vis.call(this),this.height(40),this.width(600),this.vertical_padding(10),this.horizontal_padding(10),this.max_position(100),this.min_position(0),this.interval(5),this.scale_multiplier(1),this.fixed_window_width(-1),this.callback_always(!1)},vq.FlexScroll.prototype=pv.extend(vq.Vis),vq.FlexScroll.prototype.property("max_position",Number).property("min_position",Number).property("interval",Number).property("scale_multiplier",Number).property("callback_always",Boolean).property("fixed_window_width",Number),vq.FlexScroll.prototype._setOptionDefaults=function(a){a.max_position!=null&&this.max_position(a.max_position),a.min_position!=null&&this.min_position(a.min_position),a.plotHeight!=null&&this.height(a.plotHeight),a.plotWidth!=null&&this.width(a.plotWidth),a.vertical_padding!=null&&this.vertical_padding(a.vertical_padding),a.horizontal_padding!=null&&this.horizontal_padding(a.horizontal_padding),a.interval!=null&&this.interval(a.interval),a.callback_always!=null&&(this.callback_always=a.callbackAlways),a.scale_multiplier!=null&&this.scale_multiplier(a.scale_multiplier),a.fixed_window_width!=null&&this.fixed_window_width(a.fixed_window_width),a.container&&this.container(a.container),a.notifier&&(this.notifier=a.notifier),a.dblclick_notifier&&(this.dblclick_notifier=a.dblclick_notifier)},vq.FlexScroll.prototype.set_position=function(a,b){this.window={x:this.xScale(a),dx:this.xScale(b)},this.render()},vq.FlexScroll.prototype.draw=function(a){var b=new vq.models.FlexScrollData(a);b.isDataReady()&&(this._setOptionDefaults(b),this.data=b,this.render())},vq.FlexScroll.prototype.render=function(){var a=this,b=this.width(),c=this.height(),d=this.width()-2*this.horizontal_padding(),e=pv.Scale.linear(0,b).range(this.min_position(),this.max_position()),f=pv.Scale.linear(this.min_position(),this.max_position()).range(0,d),g=this.fixed_window_width()>0,h=g?this.fixed_window_width():this.interval(),j=this.max_position(),k=this.min_position(),l=(j-k)/2,m=pv.Format.number(),n=this.scale_multiplier(),o=2*l/d;this.window==undefined&&(this.window={x:f(this.min_position()),dx:f(this.min_position()+h)-f(this.min_position())}),this.xScale=f;var p=function(b){var c=s(b);a.dblclick_notifier(c.x,c.dx)},q=function(){var b=this.transform().invert(),c=(j-k)/2,g=j-c,h=2*c/d,l=b.x*h-c+g,m=g+(d*b.k+b.x)*h-c;f.domain(l,m).nice(),e.range(l,m),a.notifier(i.x*h+g-c,i.dx*h),z.render()},r=function(a){var b=pv.min([pv.max(f.domain()),j]),c=pv.max([pv.min(f.domain()),k]),e=(b-c)/2,i=2*e/d;return{x:Math.round(a.x*i+c),dx:g?Math.round(h*i):Math.round(a.dx*i)}},s=function(a){var b=r(a);return{x:b.x*n,dx:b.dx*n}},t=function(b){this.parent.active(!0),this.fillStyle("steelblue"),a.callbackAlways&&y(b),z.render()},u=function(a){this.fillStyle(undefined),y(a),z.render()},v=function(b){this.parent.active(!0),a.callbackAlways&&y(b),z.render()},w=function(a){y(a),z.render()},x=function(a){return a},y=function(b){var c=s(b);a.notifier(c.x,c.dx)},z=(new pv.Panel).width(b).height(c).strokeStyle("#aaa").canvas(a.container()),A=z.add(pv.Panel).left(this.horizontal_padding()).width(d).top(this.vertical_padding()).bottom(12).events("all").event("mousemove",pv.Behavior.point(Infinity).collapse("y")).def("active",!1),B=A.add(pv.Panel).data([a.window]).fillStyle("white").events("all").cursor("crosshair"),C=A.add(pv.Bar).data([a.window]).left(function(a){return a.x}).width(function(a){return g==!0?f(h):a.dx}).def("fillStyle","rgba(255, 128, 128, .4)").cursor("move").events("painted").event("mousedown",pv.Behavior.drag()).event("drag",function(b){a.callbackAlways&&y(b),z.render()}).event("dragstart",t).event("dragend",u).event("point",function(){this.parent.active(!0);return z.render()}).event("unpoint",function(){this.parent.active(!1);return z.render()}).event("dblclick",function(a){p(a)});B.add(pv.Label).top(2).left(function(a){return a.x+a.dx/2-10}).text(function(a){return r(a).dx}),A.add(pv.Rule).data(function(){return f.ticks()}).left(f).strokeStyle("#eee").fillStyle("white").anchor("bottom").add(pv.Label).text(f.tickFormat);if(!g){A.add(pv.Bar).data([this.window]).fillStyle("steelblue").left(function(a){return a.x+a.dx}).width(function(a){return 4}).events("painted").event("mousedown",pv.Behavior.resize("right")).event("resize",function(b){a.callbackAlways&&y(b),z.render()}).event("resizestart",v).event("resizeend",w);var D=z.add(pv.Panel).data([this.window]);D.anchor("left").add(pv.Label).visible(function(){return x(A.active())}).text(function(a){return r({x:a.x,dx:0}).x}),D.anchor("right").add(pv.Label).visible(function(){return x(A.active())}).text(function(a){return r({x:a.x+a.dx,dx:0}).x}),A.add(pv.Bar).data([this.window]).fillStyle("steelblue").left(function(a){return a.x-4}).width(function(a){return 4}).events("painted").event("mousedown",pv.Behavior.resize("left")).event("resize",function(b){a.callbackAlways&&y(b),z.render()}).event("resizeend",w).event("resizestart",v)}z.render(),y(this.window)},vq.models.FlexScrollData=function(a){vq.models.VisData.call(this,a),this.setDataModel(),this.getDataType()=="vq.models.FlexScrollData"?this._build_data(this.getContents()):console.warn("Unrecognized JSON object.  Expected vq.models.FlexPlotData object.")},vq.models.FlexScrollData.prototype=pv.extend(vq.models.VisData),vq.models.FlexScrollData.prototype._build_data=function(a){this._processData(a),this.interval===undefined&&(this.interval=(this.max_position-this.min_position)/20),this.setDataReady(!0)},vq.models.FlexScrollData.prototype.setDataModel=function(){this._dataModel=[{label:"width",id:"PLOT.width",cast:Number,defaultValue:600},{label:"height",id:"PLOT.height",cast:Number,defaultValue:40},{label:"container",id:"PLOT.container",optional:!0},{label:"vertical_padding",id:"PLOT.vertical_padding",cast:Number,defaultValue:10},{label:"horizontal_padding",id:"PLOT.horizontal_padding",cast:Number,defaultValue:10},{label:"min_position",id:"PLOT.min_position",cast:Number,defaultValue:0},{label:"max_position",id:"PLOT.max_position",cast:Number,defaultValue:100},{label:"scale_multiplier",id:"PLOT.scale_multiplier",cast:Number,defaultValue:1},{label:"fixed_window_width",id:"PLOT.fixed_window_width",cast:Number,defaultValue:-1},{label:"interval",id:"PLOT.interval",cast:Number,optional:!0},{label:"notifier",id:"notifier",defaultValue:function(a){return null}},{label:"callback_always",id:"callback_always",cast:Boolean,defaultValue:!0},{label:"dblclick_notifier",id:"dblclick_notifier",defaultValue:function(a){return null}}]}