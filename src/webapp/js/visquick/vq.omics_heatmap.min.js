vq.OmicsHeatmap=function(){vq.Vis.call(this),this.height(400),this.width(400),this.vertical_padding(0),this.horizontal_padding(0)},vq.OmicsHeatmap.prototype=pv.extend(vq.Vis),vq.OmicsHeatmap.prototype.setSize=function(a,b){a>1&&b>1&&(this.width(b),this.height(a),this._render())},vq.OmicsHeatmap.prototype._setOptionDefaults=function(a){a.height!=null&&this.height(a.height),a.width!=null&&this.width(a.width),a.container&&this.container(a.container),a.vertical_padding!=null&&this.vertical_padding(a.vertical_padding),a.horizontal_padding!=null&&this.horizontal_padding(a.horizontal_padding)},vq.OmicsHeatmap.prototype.draw=function(a){var b=new vq.models.OmicsHeatmapData(a);b.isDataReady()?(this._setOptionDefaults(b),this.data=b,this._render()):console.warn("Invalid data input.  Check data for missing or improperly formatted values.")},vq.OmicsHeatmap.prototype._render=function(){var a=this.data,b=this.width(),c=this.height(),d=this.container(),e=this.vertical_padding(),f=this.horizontal_padding(),g=a.cell_fillStyle,h=(new pv.Panel).left(f).top(e).width(b).height(c).fillStyle(null).canvas(d),i=a.datamatrix[0].length*a.item_width,j=h.add(pv.Panel).width(i).height((a.item_height+a.item_row_padding)*a.datamatrix.length).strokeStyle("rgba(40,40,40,1.0)").lineWidth(1),k=j.add(pv.Panel).data(pv.range(0,a.datamatrix.length)).height(a.item_height).top(function(b){return b*(a.item_height+a.item_row_padding)}).strokeStyle(null).fillStyle(null).lineWidth(a.item_row_padding/2).width(i);k.add(pv.Image).width(i).height(a.item_height).image(g.by(function(b,c){return a.datamatrix[this.parent.index][Math.floor(b/a.item_width)]}));var l=j.add(pv.Panel),m=l.add(pv.Panel).data(function(){return a.active==-1?[-1]:pv.range(Math.max(0,a.active-3),Math.min(a.active+4,a.datamatrix.length))}).visible(function(a){return a>-1}).height(a.item_height*4).top(function(b){return b*(a.item_height+a.item_row_padding)-a.item_height*2}),n=m.add(pv.Panel).visible(function(b){return b>-1&&a.active==b}).fillStyle("rgba(255,255,255,1.0)").strokeStyle("rgba(40,40,40,1)").lineWidth(1).width(i);n.add(pv.Image).image(g.by(function(b,c){return a.datamatrix[a.active][Math.floor(b/a.item_width)]})),m.add(pv.Label).right(i+5).textBaseline("top").textAlign("right").top(function(b){return(b-a.active)*(a.item_height+Math.max(8,a.item_row_padding))}).font(function(b){return b!=a.active?"10px bold courier, monospace":a.row_label_font}).text(function(b){return a.row_label_prefix+a.row_labels[b]});var o=l.add(pv.Panel).data(function(){return[a.column]}).visible(function(b){return b>-1&&a.active>-1}).left(function(b){return b*a.item_width+(a.column<a.datamatrix.length/5?0:a.column>a.datamatrix.length*3/5?("Column: "+a.column_labels[b]).length*-6:-50)}).width(function(b){return Math.max(("Column: "+a.column_labels[b]).length*6.2,200)}).fillStyle("rgba(240,240,240,1.0)").strokeStyle("rgba(40,40,40,1.0)").lineWidth(.5).top(function(){return a.active*(a.item_height+a.item_row_padding)+(a.item_height+a.item_row_padding)*(a.active<a.datamatrix.length/2?3:-9)}).height(30);o.anchor("left").add(pv.Label).font("10px bold Courier, monospace").top(5).text(function(b){return"Column: "+a.column_labels[b]}).add(pv.Label).top(15).text(function(b){return"Value: "+a.datamatrix[a.active][a.column]});var p=j.add(pv.Panel).events("all").data([{y:0,dy:0,fix:0}]).cursor("crosshair").event("mousedown",pv.Behavior.select()).event("select",function(){p.render()}).event("selectend",function(b){var c=vq.utils.VisUtils.translateToReferenceCoord({x:0,y:b.y},this),d=Math.floor(c.y/(a.item_height+a.item_row_padding)),e=Math.floor((c.y+b.dy)/(a.item_height+a.item_row_padding));if(!(e<d)){var f=pv.permute(a.row_labels,pv.range(d,e+1,1));a.select_notifier(f),b.dy=0,p.render()}}).add(pv.Bar).left(-5).width(5).fillStyle("rgba(255,0,0,1)").top(function(a){var b=vq.utils.VisUtils.translateToReferenceCoord({x:0,y:a.y},this.parent);return b.y}).height(function(a){return a.dy}).strokeStyle(null).lineWidth(1),q=p.add(pv.Panel).events("all").data(pv.range(0,a.datamatrix.length)).height(a.item_height).top(function(b){return b*(a.item_height+a.item_row_padding)}).fillStyle(null).width(i).event("mouseover",function(b){a.active=b;var c=vq.utils.VisUtils.translateToReferenceCoord({x:this.mouse().x,y:0},this);a.column=Math.floor(c.x/a.item_width)-1,l.render()}).event("mousemove",function(b){a.active=b;var c=vq.utils.VisUtils.translateToReferenceCoord({x:this.mouse().x,y:0},this);a.column=Math.floor(c.x/a.item_width)-1,l.render()}).event("mouseout",function(b){a.active=-1,l.render()}).event("click",function(b){a.row_click_notifier(a.row_labels[a.active])});h.render()},vq.models.OmicsHeatmapData=function(a){vq.models.VisData.call(this,a),this._setDataModel(),this.getDataType()=="vq.models.OmicsHeatmapData"?this._build_data(this.getContents()):console.warn("Unrecognized JSON object.  Expected vq.models.OmicsHeatmapData object.")},vq.models.OmicsHeatmapData.prototype=pv.extend(vq.models.VisData),vq.models.OmicsHeatmapData.prototype._build_data=function(a){this._processData(a),this.row_labels===[]&&(this.row_labels=pv.repeat(["Default"],this.datamatrix.length)),this.imagematrix=[],this.setDataReady(!0)},vq.models.OmicsHeatmapData.prototype._setDataModel=function(){this._dataModel=[{label:"width",id:"PLOT.width",cast:Number,defaultValue:400},{label:"height",id:"PLOT.height",cast:Number,defaultValue:400},{label:"container",id:"PLOT.container",optional:!0},{label:"vertical_padding",id:"PLOT.vertical_padding",cast:Number,defaultValue:0},{label:"horizontal_padding",id:"PLOT.horizontal_padding",cast:Number,defaultValue:0},{label:"datamatrix",id:"data_matrix",defaultValue:[[]]},{label:"item_width",id:"item_width",cast:Number,defaultValue:8},{label:"item_height",id:"item_height",cast:Number,defaultValue:8},{label:"item_row_padding",id:"item_row_padding",cast:Number,defaultValue:1},{label:"cell_fillStyle",id:"fill_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:pv.Scale.linear(-1,1).range("blue","red")},{label:"item_column_padding",id:"item_column_padding",cast:Number,defaultValue:2},{label:"row_labels",id:"row_labels",defaultValue:[]},{label:"column_labels",id:"column_labels",defaultValue:[]},{label:"row_label_prefix",id:"row_label_prefix",cast:String,defaultValue:""},{label:"row_label_font",id:"row_label_font",cast:String,defaultValue:"10pt helvetica serif"},{label:"row_click_notifier",id:"row_click_notifier",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(a){}},{label:"select_notifier",id:"select_notifier",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(a){}},{label:"tooltipItems",id:"CONFIGURATION.tooltip_items",defaultValue:{X:"x",Value:"y"}}]}