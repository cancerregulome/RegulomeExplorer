vq.ScatterPlot=function(){vq.Vis.call(this),this.height(300),this.width(700),this.vertical_padding(20),this.horizontal_padding(30),this.selectedProbesetId("")},vq.ScatterPlot.prototype=pv.extend(vq.Vis),vq.ScatterPlot.prototype.property("selectedProbesetId"),vq.ScatterPlot.prototype._setOptionDefaults=function(a){a.selectedProbesetId&&(this._selectedProbesetId=a.selectedProbesetId),a.height!=null&&this.height(a.height),a.width!=null&&this.width(a.width),a.container!=null&&this.container(a.container),a.vertical_padding!=null&&this.vertical_padding(a.vertical_padding),a.horizontal_padding!=null&&this.horizontal_padding(a.horizontal_padding)},vq.ScatterPlot.prototype.onProbesetSelect=function(a){this.selectedProbesetId=a},vq.ScatterPlot.prototype.setRegression=function(a){this.data._regression=a||"none",this._render()},vq.ScatterPlot.prototype.draw=function(a){this.data=new vq.models.ScatterPlotData(a);!this.data.isDataReady()||(this._setOptionDefaults(this.data),this._visHeight=this.height()-2*this.vertical_padding(),this._visWidth=this.width()-2*this.horizontal_padding(),this._render())},vq.ScatterPlot.prototype._render=function(){function c(){var a=this.transform().invert(),b=G.width(),c=G.height(),d=(n-m)/2,e=(p-o)/2,f=n-d,g=p-e,h=2*d/b,i=2*e/c;q.domain(a.x*h-d+f,f+(b*a.k+a.x)*h-d),r.domain(-1*(c*a.k+a.y)*i+e+g,-1*a.y*i+e+g),G.render()}var a=this,b=this.container(),d=this.data,e=d.COLUMNID.x,f=d.COLUMNID.y,g=d.COLUMNID.value,h=d.data,i=h.reduce(function(a,b){return b[e]!=null&&b[e]<a?b[e]:a},999999),j=h.reduce(function(a,b){return b[e]!=null&&b[e]>a?b[e]:a},-999999),k=h.reduce(function(a,b){return b[f]!=null&&b[f]<a?b[f]:a},999999),l=h.reduce(function(a,b){return b[f]!=null&&b[f]>a?b[f]:a},-999999),m=i-Math.abs(j-i)*.03,n=j+Math.abs(j-i)*.03,o=k-Math.abs(l-k)*.03,p=l+Math.abs(l-k)*.03,q=pv.Scale.linear(m,n).range(0,this.width()),r=pv.Scale.linear(o,p).range(0,this.height()),s=d._regression;if(s=="linear")var t=h.filter(function(a,b,c){return a[f]&&a[e]}),u=pv.sum(t,function(a){return a[e]}),v=pv.sum(t,function(a){return a[f]}),w=pv.sum(t,function(a){return a[e]*a[e]}),x=pv.sum(t,function(a){return a[e]*a[f]}),y=(t.length*x-u*v)/(t.length*w-u*u),z=(v-y*u)/t.length;var A=m*.95,B=n*1.05,C=y*B+z,D=y*A+z,E=pv.Scale.linear(A,B).range(D,C),F;this._selectedProbesetId&&(F=this._selectedProbesetId);var G=(new pv.Panel).width(this.width()).height(this.height()).bottom(this.vertical_padding()).left(this.horizontal_padding()).right(this.horizontal_padding()).top(this.vertical_padding()).strokeStyle("#aaa").events("all").event("mousemove",pv.Behavior.point()).canvas(b);G.add(pv.Rule).data(function(){return r.ticks()}).bottom(r).strokeStyle(function(a){return a?"#ccc":"#999"}).anchor("left").add(pv.Label).text(r.tickFormat),G.add(pv.Label).text(d.COLUMNLABEL.y).font(a.font).textAlign("center").left(-24).bottom(this.height()/2).textAngle(-1*Math.PI/2),G.add(pv.Rule).data(function(){return q.ticks()}).left(q).strokeStyle(function(a){return a?"#ccc":"#999"}).anchor("bottom").add(pv.Label).text(q.tickFormat),G.add(pv.Label).text(d.COLUMNLABEL.x).font(a.font).textAlign("center").bottom(-30).left(this.width()/2);var H=G.add(pv.Panel).events("all").overflow("hidden");!isNaN(y)&&s=="linear"&&H.add(pv.Line).data([A,B]).left(function(a){return q(a)}).bottom(function(a){return r(E(a))}).strokeStyle("#0b0");var I=function(a){return pv.color(d._strokeStyle(a))},J=function(a){return pv.color(d._fillStyle(a))};H.add(pv.Dot).def("active",-1).data(h).left(function(a){return q(a[e])}).bottom(function(a){return r(a[f])}).strokeStyle(I).fillStyle(J).radius(d._radius).shape(d._shape).event("point",function(){return this.active(this.index).parent}).event("unpoint",function(){return this.active(-1).parent}).event("click",d._notifier).anchor("right").add(pv.Label).visible(function(){return this.anchorTarget().active()==this.index}).text(function(a){return d.COLUMNLABEL.value+" "+a[g]}),G.add(pv.Panel).left(0).bottom(0).events("all").event("mousedown",pv.Behavior.pan()).event("mousewheel",pv.Behavior.zoom()).event("pan",c).event("zoom",c),G.render()},vq.models.ScatterPlotData=function(a){vq.models.VisData.call(this,a),this.setDataModel(),this.getDataType()=="vq.models.ScatterPlotData"?this._build_data(this.getContents()):console.warn("Unrecognized JSON object.  Expected vq.models.ScatterPlotData object.")},vq.models.ScatterPlotData.prototype=pv.extend(vq.models.VisData),vq.models.ScatterPlotData.prototype.setDataModel=function(){this._dataModel=[{label:"width",id:"PLOT.width",cast:Number,defaultValue:400},{label:"height",id:"PLOT.height",cast:Number,defaultValue:300},{label:"container",id:"PLOT.container",optional:!0},{label:"vertical_padding",id:"PLOT.vertical_padding",cast:Number,defaultValue:20},{label:"horizontal_padding",id:"PLOT.horizontal_padding",cast:Number,defaultValue:30},{label:"data",id:"data_array",defaultValue:[]},{label:"COLUMNID.x",id:"xcolumnid",cast:String,defaultValue:"X"},{label:"COLUMNID.y",id:"ycolumnid",cast:String,defaultValue:"Y"},{label:"COLUMNID.value",id:"valuecolumnid",cast:String,defaultValue:"VALUE"},{label:"COLUMNLABEL.x",id:"xcolumnlabel",cast:String,defaultValue:""},{label:"COLUMNLABEL.y",id:"ycolumnlabel",cast:String,defaultValue:""},{label:"COLUMNLABEL.value",id:"valuecolumnlabel",cast:String,defaultValue:""},{label:"COLUMNLABEL.value",id:"valuecolumnlabel",cast:String,defaultValue:""},{label:"tooltipItems",id:"tooltip_items",defaultValue:{X:"X",Y:"Y",Value:"VALUE"}},{label:"_fillStyle",id:"fill_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return pv.color("steelblue").alpha(.2)}},{label:"_strokeStyle",id:"stroke_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return"steelblue"}},{label:"_radius",id:"radius",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return 2}},{label:"_shape",id:"shape",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return"dot"}},{label:"_regression",id:"regression",cast:String,defaultValue:"none"},{label:"_notifier",id:"notifier",cast:Function,defaultValue:function(){return null}}]},vq.models.ScatterPlotData.prototype._build_data=function(a){this._processData(a),this.COLUMNLABEL.x==""&&(this.COLUMNLABEL.x=this.COLUMNID.x),this.COLUMNLABEL.y==""&&(this.COLUMNLABEL.y=this.COLUMNID.y),this.COLUMNLABEL.value==""&&(this.COLUMNLABEL.value=this.COLUMNID.value),this.data.length>0&&this.setDataReady(!0)}