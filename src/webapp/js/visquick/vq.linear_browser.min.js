vq.LinearBrowser=function(){vq.Vis.call(this),this.height(40),this.width(600),this.vertical_padding(10),this.horizontal_padding(10),this.max_position(100),this.min_position(0),this.context_height(50)},vq.LinearBrowser.prototype=pv.extend(vq.Vis),vq.LinearBrowser.prototype.property("max_position",Number).property("min_position",Number).property("context_height",Number),vq.LinearBrowser.prototype._setOptionDefaults=function(a){a.max_position!=null&&this.max_position(a.max_position),a.min_position!=null&&this.min_position(a.min_position),a.context_height!=null&&this.context_height(a.context_height),a.height!=null&&this.height(a.height),a.width!=null&&this.width(a.width),a.container&&this.container(a.container),a.vertical_padding!=null&&this.vertical_padding(a.vertical_padding),a.horizontal_padding!=null&&this.horizontal_padding(a.horizontal_padding)},vq.LinearBrowser.prototype.setFocusRange=function(a,b){var c=Math.max(this.min_position(),a),d=Math.min(this.max_position()-c,b);this.window={x:this.context_posX(c),dx:this.context_posX(d)-this.context_posX(0)},this.focus_window={x:0,dx:0},this.drawPanel.render()},vq.LinearBrowser.prototype.getFocusRange=function(){var a=this.posX.domain();return{x:a[0],dx:a[1]-a[0]}},vq.LinearBrowser.prototype.draw=function(a){this._li_br_data=new vq.models.LinearBrowserData(a),this._li_br_data.isDataReady()&&(this._setOptionDefaults(this._li_br_data),this._render())},vq.LinearBrowser.prototype._render=function(){var a=this,b=this._li_br_data;this.visibleWidth=this.width()-2*this.horizontal_padding(),this.visibleHeight=this.height()-this.vertical_padding()*2,this.focus_height=this.visibleHeight-this.context_height(),this.posX=pv.Scale.linear().range(0,a.visibleWidth),this.context_posX=pv.Scale.linear(a.min_position(),a.max_position()).range(0,a.visibleWidth),a.window={x:a.context_posX.range()[0]*.2,dx:(a.context_posX.range()[1]-a.context_posX.range()[0])*.6},a.posX.domain(a.context_posX.invert(a.window.x),a.context_posX.invert(a.window.x+a.window.dx)),a.focus_window={x:0,dx:0};var c=pv.Scale.linear(a.min_position(),a.max_position()).range(0,a.visibleWidth),d=a.context_height()/a.focus_height,e=function(a){var b=10,c=Math.log(b),d=function(a){return Math.log(a)/c},e=function(a){return Math.pow(b,a)};n=a[0]<0,i=Math.floor(n?-d(-a[0]):d(a[0])),j=Math.ceil(n?-d(-a[1]):d(a[1]));return function(){return pv.range(i,j+1,1).map(e)}},f=function(c){var d=a.context_posX.invert(a.window.x),e=a.context_posX.invert(a.window.x+a.window.dx),f=b.tracks[c].data_array.map(function(a){return a}),g=pv.max(f.filter(function(a){return a.start<d}),function(a){return a.start}),h=pv.min(f.filter(function(a){return a.start>e}),function(a){return a.start});a.posX.domain(d,e),f=b.tracks[c].type=="tile"?f.filter(function(a){return a.start<=e||a.end>=d}):f.filter(function(a){return a.start<=h&&a.start>=g});return f},g=(new pv.Panel).top(a.vertical_padding()).bottom(a.vertical_padding()).left(a.horizontal_padding()).right(a.horizontal_padding()).width(a.width()).height(a.height()).fillStyle(null).canvas(a.container()),h=g.add(pv.Panel).width(a.visibleWidth);this.drawPanel=h;var k=h.add(pv.Panel).top(0).height(a.focus_height),l=k.add(pv.Panel).bottom(0),m=k.add(pv.Panel),o=k.add(pv.Panel).bottom(0);k.add(pv.Rule).left(0).add(pv.Rule).data(function(){return a.posX.ticks()}).left(a.posX).strokeStyle("#888").anchor("bottom").add(pv.Label).text(a.posX.tickFormat);var p=l.add(pv.Panel).left(0).width(a.visibleWidth),q=o.add(pv.Panel).left(0).fillStyle(null).strokeStyle(null).width(a.visibleWidth),r;for(var s=0;s<b.tracks.length;s++){var t=b.tracks[s].fillStyle,u=b.tracks[s].strokeStyle,v=b.tracks[s].lineWidth;r=b.tracks[s].track_height;var w=p.add(pv.Panel).data([s]),x=w.add(pv.Panel).data(function(a){return[b.tracks[a]]}).bottom(function(a,c){return pv.sum(b.tracks.slice(0,c),function(a){return a.track_height+a.track_padding})}).fillStyle(function(a){return a.trackFillStyle()}).strokeStyle(function(a){return a.trackStrokeStyle()}).lineWidth(function(a){return a.trackLineWidth()}).height(function(a){return a.track_height+a.track_padding}),y=q.add(pv.Panel).data([s]),z=y.add(pv.Panel).data(function(a){return[b.tracks[a]]}).bottom(function(a,c){return pv.sum(b.tracks.slice(0,c),function(a){return a.track_height+a.track_padding})}).height(function(a){return a.track_height+a.track_padding}),A,B,C,D,E,F,G,H=b.tracks[s].num_y_rule_lines;D=z.add(pv.Panel).height(r).bottom(2).events("painted").overflow("hidden");var I=b.tracks[s].value_key;switch(b.tracks[s].type){case"scatter":case"scatterplot":F=b.tracks[s].shape,G=b.tracks[s].radius,B=b.tracks[s].min_value!=undefined?b.tracks[s].min_value:pv.min(b.tracks[s].data_array,function(a){return a[I]}),C=b.tracks[s].max_value!=undefined?b.tracks[s].max_value:pv.max(b.tracks[s].data_array,function(a){return a[I]}),A=pv.Scale.linear(B,C).range(0,r),b.tracks[s].yaxis_scale_type!=undefined&&b.tracks[s].yaxis_scale_type!=null&&b.tracks[s].yaxis_scale_type=="log"&&(B=B>0?B:1,b.tracks[s].base_value=b.tracks[s].base_value>0?b.tracks[s].base_value:B,A=pv.Scale.log(B,C).range(0,r).nice(),A.ticks=e(A.domain())),b.tracks[s].yScale=A,E=D.add(pv.Dot).data(function(a,b,c){return f(c)}).left(function(b){return a.posX(b.start)}).lineWidth(v).bottom(function(a,b){return b.yScale(a[I])}).fillStyle(t).shape(F).radius(G).strokeStyle(u),E.event("mouseover",pv.Behavior.hovercard({include_header:!1,include_footer:!0,self_hover:!0,timeout:b.tracks[s]._tooltip_timeout,data_config:b.tracks[s]._tooltipItems,tool_config:b.tracks[s]._tooltipLinks})),b.tracks[s].notifier!=undefined&&E.cursor("pointer").event("click",function(a,b){b.notifier(a,b)}),z.add(pv.Rule).bottom(function(a){return a.yScale(a.base_value)}).add(pv.Rule).data(function(a){return a.yScale.ticks(H)}).bottom(function(a,b){return b.yScale(a)}).strokeStyle("#222").anchor("left").add(pv.Label).font("4pt").text(function(a,b){return b.yScale.tickFormat(a)});break;case"line":B=b.tracks[s].min_value!=undefined?b.tracks[s].min_value:pv.min(b.tracks[s].data_array,function(a){return a[I]}),C=b.tracks[s].max_value!=undefined?b.tracks[s].max_value:pv.max(b.tracks[s].data_array,function(a){return a[I]}),A=pv.Scale.linear(B,C).range(0,r),b.tracks[s].yaxis_scale_type!=undefined&&b.tracks[s].yaxis_scale_type!=null&&b.tracks[s].yaxis_scale_type=="log"&&(B=B>0?B:1,b.tracks[s].base_value=b.tracks[s].base_value>0?b.tracks[s].base_value:B,A=pv.Scale.log(B,C).range(0,r).nice(),A.ticks=e(A.domain())),b.tracks[s].yScale=A,E=D.add(pv.Line).data(function(a,b,c){return f(c)}).left(function(b){return a.posX(b.start)}).lineWidth(v).bottom(function(a,b){return b.yScale(a[I])}).fillStyle(t).strokeStyle(u),E.event("mouseover",pv.Behavior.hovercard({include_header:!1,include_footer:!0,self_hover:!0,timeout:b.tracks[s]._tooltip_timeout,data_config:b.tracks[s]._tooltipItems,tool_config:b.tracks[s]._tooltipLinks})),b.tracks[s].notifier!=undefined&&E.cursor("pointer").event("click",function(a,b){b.notifier(a,b)}),z.add(pv.Rule).bottom(function(a){return a.yScale(a.base_value)}).add(pv.Rule).data(function(a){return a.yScale.ticks(H)}).bottom(function(a,b){return b.yScale(a)}).strokeStyle("#222").anchor("left").add(pv.Label).font("4pt").text(function(a,b){return b.yScale.tickFormat(a)});break;case"bar":B=b.tracks[s].min_value!=undefined?b.tracks[s].min_value:pv.min(b.tracks[s].data_array,function(a){return a[I]}),C=b.tracks[s].max_value!=undefined?b.tracks[s].max_value:pv.max(b.tracks[s].data_array,function(a){return a[I]}),A=pv.Scale.linear(B,C).range(0,r),b.tracks[s].yaxis_scale_type!=undefined&&b.tracks[s].yaxis_scale_type!=null&&b.tracks[s].yaxis_scale_type=="log"&&(B=B>0?B:1,b.tracks[s].base_value=b.tracks[s].base_value>0?b.tracks[s].base_value:B,A=pv.Scale.log(B,C).range(0,r).nice(),A.ticks=e(A.domain())),b.tracks[s].yScale=A,E=D.add(pv.Bar).data(function(a,b,c){return f(c)}).left(function(b){return a.posX(b.start)}).lineWidth(v).width(function(b){return a.posX(b.end)-a.posX(b.start)}).bottom(function(a,b){return b.yScale(Math.min(b.base_value,a[I]))}).height(function(a,b){return b.yScale(Math.max(b.base_value,a[I]))-this.bottom()}).fillStyle(t).strokeStyle(u),E.event("mouseover",pv.Behavior.hovercard({include_header:!1,include_footer:!0,self_hover:!0,timeout:b.tracks[s]._tooltip_timeout,data_config:b.tracks[s]._tooltipItems,tool_config:b.tracks[s]._tooltipLinks})),b.tracks[s].notifier!=undefined&&E.cursor("pointer").event("click",function(a,b){b.notifier(a,b)}),z.add(pv.Rule).bottom(function(a){return a.yScale(a.base_value)}).add(pv.Rule).data(function(a){return a.yScale.ticks(H)}).bottom(function(a,b){return b.yScale(a)}).strokeStyle("#222").anchor("left").add(pv.Label).font("4pt").text(function(a,b){return b.yScale.tickFormat(a)});break;case"glyph":F=b.tracks[s].shape,G=b.tracks[s].radius,E=D.add(pv.Dot).data(function(a,b,c){return f(c)}).left(function(b){return a.posX(b.start)}).bottom(function(a,b){return a.level*(b.tile_height+b.tile_padding)+G*2}).shape(F).radius(G).fillStyle(t).strokeStyle(u),b.tracks[s]._tooltipItems!=undefined&&E.event("mouseover",pv.Behavior.hovercard({include_header:!1,include_footer:!0,self_hover:!0,timeout:b.tracks[s]._tooltip_timeout,data_config:b.tracks[s]._tooltipItems,tool_config:b.tracks[s]._tooltipLinks})),b.tracks[s].notifier!=undefined&&E.cursor("pointer").event("click",function(a,b){b.notifier(a,b)});break;case"tile":default:E=D.add(pv.Bar).data(function(a,b,c){return f(c)}).left(function(b){return a.posX(b.start)}).width(function(b){return a.posX(b.end)-a.posX(b.start)}).bottom(function(a,b){return a.level*(b.tile_height+b.tile_padding)}).height(function(a,b){return b.tile_height}).lineWidth(1).fillStyle(t).strokeStyle(u),b.tracks[s]._tooltipItems!=undefined&&E.event("mouseover",pv.Behavior.hovercard({include_header:!1,include_footer:!0,self_hover:!0,timeout:b.tracks[s]._tooltip_timeout,data_config:b.tracks[s]._tooltipItems,tool_config:b.tracks[s]._tooltipLinks})),b.tracks[s].notifier!=undefined&&E.cursor("pointer").event("click",function(a,b){b.notifier(a,b)})}z.add(pv.Label).font("12pt helvetica").title(function(a){return a.description}).text(function(a){return a.label}).left(0).top(0).textAlign("left").textStyle("#333").textBaseline("top")}var J=h.add(pv.Panel).bottom(0).width(a.visibleWidth).left(0).height(a.context_height()),K=J.add(pv.Panel).bottom(0);for(s=0;s<b.tracks.length;s++){var L=K.add(pv.Panel).data([s]),M=L.add(pv.Panel).data(function(a){return[b.tracks[a]]}).bottom(function(a,c){return pv.sum(b.tracks.slice(0,c),function(a){return a.track_height+a.track_padding})*d}).height(function(a){return(a.track_height+a.track_padding)*d}).width(a.visibleWidth).overflow("hidden").fillStyle(function(a){return a.trackFillStyle()}).strokeStyle(function(a){return a.trackStrokeStyle()}).lineWidth(function(a){return a.trackLineWidth()}).left(0);switch(b.tracks[s].type){case"scatter":case"scatterplot":M.add(pv.Dot).data(function(a){return a.data_array}).left(function(a){return c(a.start)}).bottom(function(a,b){return b.yScale(a[I])*d}).radius(1).shape("circle").fillStyle(function(){return"#00c"}).strokeStyle(function(){return"#009"});break;case"line":M.add(pv.Line).data(function(a){return a.data_array}).left(function(a){return c(a.start)}).bottom(function(a,b){return b.yScale(a[I])*d}).fillStyle(function(){return null}).lineWidth(.5).strokeStyle(function(){return"#009"});break;case"bar":M.add(pv.Bar).data(function(a){return a.data_array}).left(function(a){return c(a.start)}).width(function(a){return c(a.end-a.start)}).bottom(function(a,b){return b.yScale(Math.min(b.base_value,a[I]))*d}).height(function(a,b){return b.yScale(Math.max(b.base_value,a[I]))*d-this.bottom()}).lineWidth(1).fillStyle(function(){return"#00c"}).strokeStyle(function(){return"#009"});break;case"glyph":M.add(pv.Dot).data(function(a){return a.data_array}).left(function(a){return c(a.start)}).shape("circle").radius(.5).bottom(function(a,b){return(a.level*(b.tile_padding+b.tile_height)+b.radius*2)*d}).fillStyle(function(){return"#00c"}).strokeStyle(function(){return"#009"});break;case"tile":default:M.add(pv.Bar).data(function(a){return a.data_array}).left(function(a){return c(a.start)}).width(function(a){return c(a.end-a.start)}).bottom(function(a,b){return a.level*(b.tile_padding+b.tile_height)*d}).height(function(a,b){return b.tile_height*d}).lineWidth(1).fillStyle(function(){return"#00c"}).strokeStyle(function(){return"#009"})}}J.add(pv.Rule).left(0).add(pv.Rule).data(a.context_posX.ticks()).left(a.context_posX).strokeStyle("#888").anchor("bottom").add(pv.Label).text(a.context_posX.tickFormat),J.add(pv.Rule).bottom(0),J.add(pv.Rule).bottom(0).add(pv.Label).bottom(-21).text(b.axes.x.label),J.add(pv.Panel).data(function(){return[a.window]}).cursor("crosshair").events("all").event("mousedown",pv.Behavior.select()).event("select",function(){a.window.dx<2||k.render()}).add(pv.Bar).left(function(a){return a.x}).width(function(a){return a.dx}).fillStyle("rgba(255, 128, 128, .4)").cursor("move").event("mousedown",pv.Behavior.drag()).event("drag",k),m.data(function(){return[a.focus_window]}).cursor("crosshair").events("all").event("mousedown",pv.Behavior.select()).event("selectend",function(){a.focus_window.dx<2?(a.focus_window={x:0,dx:0},k.render(),J.render()):(a.window={x:a.context_posX(a.posX.invert(a.focus_window.x)),dx:a.context_posX(a.posX.invert(a.focus_window.dx))-a.context_posX(a.posX.invert(0))},a.focus_window={x:0,dx:0},k.render(),J.render())}).add(pv.Bar).left(function(a){return a.x}).width(function(a){return a.dx}).fillStyle("rgba(128, 128, 255, .4)"),g.render()},vq.models.LinearBrowserData=function(a){vq.models.VisData.call(this,a),this._setDataModel(),this.getDataType()=="vq.models.LinearBrowserData"?this._build_data(this.getContents()):console.warn("Unrecognized JSON object.  Expected vq.models.LinearBrowserData object.")},vq.models.LinearBrowserData.prototype=pv.extend(vq.models.VisData),vq.models.LinearBrowserData.prototype._setDataModel=function(){this._dataModel=[{label:"width",id:"PLOT.width",cast:Number,defaultValue:400},{label:"height",id:"PLOT.height",cast:Number,defaultValue:400},{label:"container",id:"PLOT.container",optional:!0},{label:"vertical_padding",id:"PLOT.vertical_padding",cast:Number,defaultValue:0},{label:"horizontal_padding",id:"PLOT.horizontal_padding",cast:Number,defaultValue:0},{label:"min_position",id:"PLOT.min_position",cast:Number,defaultValue:0},{label:"max_position",id:"PLOT.max_position",cast:Number,defaultValue:100},{label:"context_height",id:"PLOT.context_height",cast:Number,defaultValue:50},{label:"axes.x.label",id:"PLOT.axes.x.label",cast:String,defaultValue:""},{label:"tracks",id:"TRACKS",defaultValue:[]}]},vq.models.LinearBrowserData.prototype._build_data=function(a){this._processData(a),this.tracks=this.tracks.map(function(a){return new vq.models.LinearBrowserData.TrackData(a)}),this.tracks.forEach(function(a){if(a.type=="tile"||a.type=="glyph"){var b=a.tile_show_all_tiles?Math.floor((a.track_height-a.radius*4)/(a.tile_height+a.tile_padding)):undefined;a.data_array=a.type=="tile"?vq.utils.VisUtils.layoutChrTiles(a.data_array,a.tile_overlap_distance,b):vq.utils.VisUtils.layoutChrTicks(a.data_array,a.tile_overlap_distance,b)}}),this.setDataReady(!0)},vq.models.LinearBrowserData.TrackData=function(a){vq.models.VisData.call(this,{CONTENTS:a}),this._setDataModel(),this._build_data(this.getContents())},vq.models.LinearBrowserData.TrackData.prototype=pv.extend(vq.models.VisData),vq.models.LinearBrowserData.TrackData.prototype._setDataModel=function(){this._dataModel=[{label:"label",id:"label",cast:String,defaultValue:""},{label:"type",id:"type",cast:String,defaultValue:"scatter"},{label:"_plot.axes.y.label",id:"CONFIGURATION.axes.y.label",cast:String,defaultValue:""},{label:"fillStyle",id:"CONFIGURATION.fill_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:null},{label:"strokeStyle",id:"CONFIGURATION.stroke_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:null},{label:"lineWidth",id:"CONFIGURATION.line_width",cast:vq.utils.VisUtils.wrapProperty,defaultValue:vq.utils.VisUtils.wrapProperty(1)},{label:"trackFillStyle",id:"CONFIGURATION.track_fill_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:function(){return pv.color("#FFFFFF")}},{label:"trackStrokeStyle",id:"CONFIGURATION.track_stroke_style",cast:vq.utils.VisUtils.wrapProperty,defaultValue:null},{label:"trackLineWidth",id:"CONFIGURATION.track_line_width",cast:vq.utils.VisUtils.wrapProperty,defaultValue:vq.utils.VisUtils.wrapProperty(1)},{label:"track_height",id:"CONFIGURATION.track_height",cast:Number,defaultValue:80},{label:"track_padding",id:"CONFIGURATION.track_padding",cast:Number,defaultValue:20},{label:"base_value",id:"CONFIGURATION.base_value",cast:Number,defaultValue:0},{label:"max_value",id:"CONFIGURATION.max_value",cast:Number,defaultValue:null,optional:!0},{label:"min_value",id:"CONFIGURATION.min_value",cast:Number,defaultValue:null,optional:!0},{label:"num_y_rule_lines",id:"CONFIGURATION.num_y_rule_lines",cast:Number,defaultValue:3},{label:"shape",id:"CONFIGURATION.shape",cast:String,defaultValue:"circle"},{label:"radius",id:"CONFIGURATION.radius",cast:Number,defaultValue:5},{label:"yaxis_scale_type",id:"CONFIGURATION.yaxis_scale_type",cast:String,defaultValue:"linear"},{label:"notifier",id:"CONFIGURATION.notifier",cast:Function,optional:!0},{label:"tile_padding",id:"CONFIGURATION.tile_padding",cast:Number,defaultValue:5},{label:"tile_overlap_distance",id:"CONFIGURATION.tile_overlap_distance",cast:Number,defaultValue:.1},{label:"tile_height",id:"CONFIGURATION.tile_height",cast:Number,defaultValue:5},{label:"tile_show_all_tiles",id:"CONFIGURATION.tile_show_all_tiles",cast:Boolean,defaultValue:!1},{label:"_tooltipItems",id:"OPTIONS.tooltip_items",defaultValue:{Start:"start",End:"end",Value:"value"}},{label:"_tooltipLinks",id:"OPTIONS.tooltip_links",defaultValue:{}},{label:"_tooltip_timeout",id:"OPTIONS.tooltip_timeout",defaultValue:200},{label:"data_array",id:"data_array",defaultValue:[]},{label:"value_key",id:"value_key",defaultValue:"value"}]},vq.models.LinearBrowserData.TrackData.prototype._build_data=function(a){this._processData(a)}